# Part I - Session

소요시간 : 4 min

## Before You Learn

- 쿠키에 대한 이해

## Achievement Goals

- 세션의 개념을 이해할 수 있다.
- 쿠키와 세션은 서로 어떤 관계이며, 각각이 인증에 있어서 어떤 목적으로 존재하는지 이해할 수 있다.
- 세션의 한계를 이해할 수 있다.

## Bare minimum requirement

- 테스트를 통과합니다.
  - `index.js` 에는 적절한 위치에 `TODO:`와 `HINT:`가 존재합니다. 해당 내용을 읽고, TODO라고 적힌 곳에 여러분이 구현하셔야 합니다.
- 클라이언트에서 쿠키에 담긴 세션 정보를 확인합니다.
- 다음 질문에 대한 답을 찾아냅니다.

#### 질문

- 세션에서 사용되는 세션 쿠키는 어떤 역할을 담당하고 있을까요?
- 쿠키만으로 인증을 구현할 때 왜 위험할까요?
- 전부 다 완성한 상태에서 로그아웃할 수 있는 방법은 쿠키를 삭제하는 방법, 또는 서버를 재시작하는 방법밖에는 없습니다. 로그아웃을 구현하려면 어떻게 해야 할까요?

## Getting Started

> 쿠키를 학습하고, 브라우저에 상태를 저장할 수 있다는 사실을 알게 된 주니어 개발자 김코딩은, 쿠키에 인증 정보를 넣어 로그인 상태를 유지할 수 있음을 알게 되었습니다.
>
> 그러나, 선배 개발자 박코딩은, 쿠키만으로 인증을 구현하는 것은 언제든 쿠키가 클라이언트에 의해 변조가 가능하기 때문에 위험하다는 사실을 알려줍니다. 이에 따라 서버에도 쿠키를 검증할 수 있는 수단을 마련하는 세션 인증 방식을 제안합니다.

**Repository** : https://github.com/codestates/im-sprint-auth-session

### 1. 환경 변수 설정

- 시작하기에 앞서 .env.example 파일이름을 .env로 바꾼다음 데이터베이스 관련 환경변수를 설정해야 합니다.

### 2. 데이터베이스 마이그레이션

시퀄라이즈 마이그레이션 및 시드를 적용하거나 직접 데이터베이스를 수정해야 합니다. 시퀄라이즈 마이그레이션 및 시드를 적용하는 방법은 [공식 문서](https://sequelize.org/master/manual/migrations.html)를 확인해 보세요.

> 회원 가입 기능은 제공되지 않으며, 구현하지도 않습니다. 다만 스프린트에서 제공한 유저정보를 활용해야 합니다. servers/seeders 폴더를 확인하면 스프린트 및 테스트에서 사용하는 유저정보를 확인할 수 있습니다.

### 3. 서버 구현

#### index.js

1. 발급받은 https 인증서를 해당 스프린트 디렉토리에 복사합니다. 쿠키 설정은 HTTPS를 사용하는 것을 고려하여 설정하세요.
2. index.js에서 CORS 및 세션 옵션을 설정합니다.

#### controller/login.js (POST /users/login)

1. request로부터 받은 userId, password와 일치하는 유저가 DB에 존재하는지 확인합니다.
2. 일치하는 유저가 없을 경우:
   - 로그인 요청을 거절합니다.
3. 일치하는 유저가 있을 경우:
   - 세션에 userId를 저장합니다.

#### controller/logout.js (POST /users/logout)

1. 세션 객체에 저장한 값이 존재하면
   - 세션을 삭제합니다. (자동으로 클라이언트 쿠키는 갱신됩니다)

#### controller/userinfo.js (POST /users/userinfo)

1. 세션 객체에 저장한 값이 존재하면
   - 사용자 정보를 데이터베이스에서 조회한 후 응답으로 전달합니다.
2. 세션 객체에 저장한 값이 존재하지 않으면
   - 요청을 거절합니다.

### 4. 클라이언트 구현

1. components/Mypage.js
2. components/Login.js
3. App.js

순서로 코드를 작성해 보세요.